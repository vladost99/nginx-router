version: '3'

services:
  nginx-router:
    image: nginx:alpine
    ports:
      - "${NGINX_PORT:-9090}:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf.template:ro
      - ./entrypoint.sh:/docker-entrypoint.d/40-envsubst-config.sh:ro
    environment:
      - FRONTEND_CONTAINER=${FRONTEND_CONTAINER:-frontend}
      - FRONTEND_PORT=${FRONTEND_PORT:-3000}
      - FRONTEND_PAGE_CONTAINER=${FRONTEND_PAGE_CONTAINER:-frontend-page}
      - FRONTEND_PAGE_PORT=${FRONTEND_PAGE_PORT:-3001}
      - BACKEND_API_CONTAINER=${BACKEND_API_CONTAINER:-backend-api}
      - BACKEND_API_PORT=${BACKEND_API_PORT:-8000}
    # Перенаправляємо логи Nginx у stdout/stderr для Docker
    command: [nginx-debug, '-g', 'daemon off;']